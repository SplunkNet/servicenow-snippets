<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title></title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

        <!--<link rel="apple-touch-icon" href="icon.png">-->
        <!-- Place favicon.ico in the root directory -->

        <link href="https://fonts.googleapis.com/css?family=Lato:100,100i,300,400,700" rel="stylesheet">
        <link rel="stylesheet" href="vendor/bootstrap.css">
        <link rel="stylesheet" href="vendor/prism.css">
        <link rel="stylesheet" href="styles/main.css">
        

        <script src="vendor/angular.min.js"></script>
    </head>
    <body ng-app="servicenowSnippets" ng-controller="mainCtrl">
        <!--[if lte IE 9]>
            <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
        <![endif]-->

        <div class="container-fluid">
            <div class="row">
                <div class="col">
                    <div class="title">
                        <h1>ServiceNow Snippets</h1>
                        <p>by Mark Miller</p>
                    </div>
                    
                </div>
            </div>
            <div class="row">
                <div class="col-md-4 fixed">
                    <p>Search:</p>
                    <input ng-model="term" />
                </div>
                <div class="col-md-8 offset-md-4">

                    <ol>
                        <li>Service Portal Snippets</li>
                        <ol>
                            <li>Widget Snippets</li>
                            <li>CSS</li>
                            <li>Header Options</li>
                            <li>Misc</li>
                        </ol>
                        <li>Platform Snippets</li>
                        <ol>
                            <li>Server-Side</li>
                            <li>Client-Side</li>
                        </ol>
                    </ol>
                    
                    <hr/>

                    <div class="entries language-javascript">

                        <div class="entry" ng-repeat="e in entries | filter: term">
                            <p ng-bind="{{e.title}}">{{e.title}}</p>
                            <pre class="line-numbers"><code>{{e.code}}</code></pre>
                        </div>



                        
<!--****************** SERVICE PORTAL SNIPPETS ******************-->
<h2>Service Portal Snippets</h2>

<h3>Widget Snippets</h3>
<h3>CSS</h3>
<h3>Header Options</h3>
<h3>Misc</h3>


<hr/>


<!--****************** PLATFORM SNIPPETS ******************-->
<h2>Platform Snippets</h2>
<h3>Server-Side</h3>
<h3>Client-Side</h3>



<div class="entry">
    <p>Service Portal Angular Events</p>
    <pre class="line-numbers"><code>$rootScope.$on('sp.form.record.updated', function() {
    $scope.data.userForm.data.f._ui_actions[1].is_button = true;
    });
    
    $rootScope.$on('data_table.click', function(event,obj) {
    var link = {};
    link.id = $scope.data.page;
    link.table = obj.table;
    link.sys_id = obj.sys_id;
    $location.search(link);
    });
    
    $scope.$on("field.change", function(evt, parms) { }</code></pre>
</div>


<div class="entry">
    <p>Display Choice Label instead of Choice Value</p>
    <pre class="line-numbers"><code>var ritm = new GlideRecord("sc_req_item");
    ritm.query();
    while(ritm.next()){
    ...
    reqItem.stage = $sp.getFieldsObject(ritm, 'stage').stage.display_value;
    ...
    }</code></pre>
</div>



<div class="entry">
<p>CatItem API</p>
<pre class="line-numbers"><code>var catalogItemJS = new sn_sc.CatItem(sc.getUniqueValue());
if (!catalogItemJS.canView())
    continue;
var catItemDetails = catalogItemJS.getItemSummary();</code></pre>
</div>

<div class="entry">
<p>CatCategory API</p>
<pre class="line-numbers"><code>categoryJS = new sn_sc.CatCategory(data.category_id);
if (!categoryJS.canView()) {
data.error = gs.getMessage("You do not have permission to see this category");
return;
}</code></pre>
</div>


<div class="entry">
<p>CatalogSearch API</p>
<pre class="line-numbers"><code>var items = data.items = [];
var catalog = $sp.getValue('sc_catalog');
var sc = new sn_sc.CatalogSearch().search(catalog, data.category_id, '', false, options.depth_search);
sc.addQuery('sys_class_name', 'NOT IN', 'sc_cat_item_wizard');
if (data.keywords)
    sc.addQuery('123TEXTQUERY321', data.keywords);
sc.orderBy('order');
sc.orderBy('name');
sc.query();
</code></pre>
</div>

<div class="entry">
<p>Recursive Function</p>
<pre class="line-numbers"><code>var results = [];
var nestedCategories = ['898fc5a0db00d74074c99447db9619d8'];

getChildren(nestedCategories[0]);
searchItems();
$sp.logSearch('sc_cat_item', data.q, results.length);
return results;


function getChildren(sysID) {
    var gr = new GlideRecord('sc_category');
    gr.addQuery('parent', sysID);
    gr.addActiveQuery();
    gr.query();
    while(gr.next()) {
        var current = gr.sys_id.toString();
        nestedCategories.push(current);
        if(hasChildren(current)) {
            getChildren(current);
        }
    }
}

function hasChildren(sysID) {
    var gr = new GlideRecord('sc_category');
    gr.addQuery('parent', sysID);
    gr.addActiveQuery();
    gr.query();
    if(gr.next()) {
        return true;
    } else {
        return false;
    }
}</code></pre>
</div>

            </div>

            
        </div>
    </div>
</div>
        


        <script src="vendor/jquery-3.3.1.min.js"></script>
        <script src="vendor/bootstrap.js"></script>
        <script src="vendor/prism.js"></script>
        <script src="app/main.js"></script>

        <!-- Google Analytics: change UA-XXXXX-Y to be your site's ID. 
        <script>
            window.ga=function(){ga.q.push(arguments)};ga.q=[];ga.l=+new Date;
            ga('create','UA-XXXXX-Y','auto');ga('send','pageview')
        </script>
        <script src="https://www.google-analytics.com/analytics.js" async defer></script>
        -->
    </body>
</html>